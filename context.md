# Project Context & Knowledge Base

## 🧠 Core Concepts (核心概念与对齐)
> 记录项目涉及的技术原理，防止 AI "幻觉"。
- **符号链接管理 (Symlink Management)**: 使用 `ln -s source target` 创建软链接，让 Home 目录中的配置文件指向仓库中的实际文件
- **模块化 Zsh 配置**: 将 `.zshrc` 拆分为多个独立文件 (01_aliases.zsh, 02_functions.zsh 等)，便于维护和版本控制
- **Oh My Zsh 框架**: 基于 Zsh 的插件管理框架，提供主题、插件和自动化配置功能
- **原子性备份**: 安装脚本自动创建带时间戳的备份文件，确保回滚安全性

## 🏗 Architecture Decisions (架构决策)
> 记录"为什么这么做"，防止反复修改已定方案。
- **符号链接 vs 硬复制**: 选择符号链接因为修改仓库文件立即生效，避免同步问题
- **shell 脚本语言选择**: 使用 Bash 而非 Python/Node.js 因为系统自带的 Bash 无需额外依赖
- **配置加载顺序**: `.zshenv` → `.zshrc` → `zsh-config/` 目录文件，确保环境变量优先设置
- **文件命名规范**: 使用数字前缀 (01_, 02_) 控制加载顺序，避免字母排序导致的逻辑错误

## 💡 Lessons Learned (已验证的结论)
> 最重要的部分。记录"什么尝试失败了"，防止重蹈覆辙。
- [2024-11-21]: 直接复制配置文件到 Home 目录会导致仓库修改与实际使用不同步
- [2024-11-21]: Oh My Zsh 必须在安装插件前就绪，否则会导致路径错误
- [2024-11-21]: 安装脚本需要幂等性 (idempotent)，支持重复运行而不产生副作用
- [2024-11-21]: `.gitignore` 需要排除实际的符号链接文件，只管理配置源文件
- [2025-11-21]: `set -euo pipefail` 过于严格，需要更好的变量检查机制
- [2025-11-21]: 数组遍历在某些 shell 环境下可能出现未定义变量问题
- [2025-11-21]: 错误信息需要更详细，便于调试

## 🔧 Technical Constraints (技术约束)
- **兼容性要求**: 支持 Ubuntu/Debian 和 macOS (CentOS/RHEL 未测试)
- **依赖要求**: Zsh 5.0+, Git 2.0+, Bash 4.0+
- **权限要求**: 安装脚本需要对 Home 目录的写权限
- **路径约束**: 仓库必须克隆到 `~/dotfiles` 路径，符号链接才能正确工作